# æ™‚åˆ»å‡¦ç†å³æ ¼ãƒ«ãƒ¼ãƒ«

## ğŸ• åŸºæœ¬åŸå‰‡ï¼ˆå¿…é ˆéµå®ˆï¼‰

ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆãƒ»å¤‰æ›´ã™ã‚‹éš›ã¯ä»¥ä¸‹ã‚’å³å®ˆã™ã‚‹ã“ã¨ï¼š

1. **å†…éƒ¨æ™‚åˆ»ã¯å®Œå…¨UTC**ï¼šJST ã¯å…¥å‡ºåŠ›å±¤ã§ã®ã¿ä½¿ç”¨
2. **æ–‡å­—åˆ—ã¯ISO-8601 (Zä»˜ã)å›ºå®š**ï¼šãƒŸãƒªç§’ä¸è¦ãªã‚‰ä¸¸ã‚ã¦ã‚‚ã‚ˆã„
3. **æ—¥æ™‚å‹ã¯TZæƒ…å ±ã‚’æŒã¤å‹é¸æŠ**ï¼šTIMESTAMP WITH TIME ZONE ãªã©
4. **å¤‰æ•°ãƒ»ã‚«ãƒ©ãƒ åã¯ *_utc ã«çµ±ä¸€**ï¼š*_jst ç¦æ­¢
5. **UTCâ†’JSTâ†’UTC round-tripãƒ†ã‚¹ãƒˆã‚’ãƒ¦ãƒ‹ãƒƒãƒˆã«è¿½åŠ **

é•åãŒã‚ã‚Œã°ç”Ÿæˆã‚’ä¸­æ­¢ã—ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™ã“ã¨ã€‚

## ğŸ—„ï¸ ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è¨­å®šè©³ç´°ï¼ˆ2025-06-22æ›´æ–°ï¼‰

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
```sql
-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«ã§UTCè¨­å®š
ALTER DATABASE mydb SET timezone TO 'UTC';

-- ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã§UTCå¼·åˆ¶
SET timezone TO 'UTC';
```

### PrismaServiceè¨­å®š
```typescript
// backend/src/prisma.service.ts
await this.$executeRaw`SET timezone TO 'UTC'`; // æ¥ç¶šæ™‚ã«UTCå¼·åˆ¶
```

## ğŸ”„ æ™‚åˆ»å¤‰æ›ãƒ•ãƒ­ãƒ¼

### æ¨™æº–å¤‰æ›ãƒ‘ã‚¿ãƒ¼ãƒ³
1. **å…¥åŠ›ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰**: JSTå°æ•°ç‚¹æ™‚åˆ»ï¼ˆä¾‹: 9.5 = 9:30 JSTï¼‰
2. **å¤‰æ›ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰**: `jstToUtc()` ã§ JST â†’ UTCå¤‰æ›
3. **ä¿å­˜ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰**: UTCæ™‚åˆ»ã¨ã—ã¦ä¿å­˜ï¼ˆä¾‹: 2025-06-22 00:30:00ï¼‰
4. **å–å¾—ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰**: `utcToJstDecimal()` ã§ UTC â†’ JSTå¤‰æ›
5. **å‡ºåŠ›ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰**: JSTå°æ•°ç‚¹æ™‚åˆ»ï¼ˆä¾‹: 9.5 = 9:30 JSTï¼‰

### å¤‰æ›ãƒ¡ã‚½ãƒƒãƒ‰ä¾‹
```typescript
// JST 9.5 (9:30) + "2025-06-22" â†’ UTC "2025-06-22T00:30:00Z"
private jstToUtc(decimalHour: number, baseDateString: string): Date {
  const jstIsoString = `${baseDateString}T${hours}:${minutes}:00+09:00`;
  return new Date(jstIsoString); // å†…éƒ¨çš„ã«UTCã§ä¿å­˜
}

// UTC "2025-06-22T00:30:00Z" â†’ JST 9.5 (9:30)
private utcToJstDecimal(utcDate: Date): number {
  const jstDate = new Date(utcDate.getTime() + 9 * 60 * 60 * 1000);
  return jstDate.getHours() + jstDate.getMinutes() / 60;
}
```

## âš ï¸ ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ³•

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- **ç—‡çŠ¶**: äºˆå®šãŒ9æ™‚é–“ãšã‚Œã¦è¡¨ç¤ºã•ã‚Œã‚‹
- **åŸå› **: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãŒAsia/Tokyoè¨­å®š
- **è§£æ±º**: ä¸Šè¨˜è¨­å®šã§UTCã«çµ±ä¸€

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ™‚åˆ»å‡¦ç†ã®æ³¨æ„ç‚¹
```typescript
// âŒ é–“é•ã„ - UTCæ™‚åˆ»ã«Z suffix
const convertTimeToDate = (time: number, baseDate: string): Date => {
  const jstIsoString = `${baseDate}T${hours}:${minutes}:00.000Z`;
  return new Date(jstIsoString); // ã“ã‚Œã¯UTCã¨ã—ã¦è§£é‡ˆã•ã‚Œã‚‹
}

// âœ… æ­£ã—ã„ - JSTæ™‚åˆ»ã«+09:00 timezone
const convertTimeToDate = (time: number, baseDate: string): Date => {
  const jstIsoString = `${baseDate}T${hours}:${minutes}:00+09:00`;
  return new Date(jstIsoString); // è‡ªå‹•çš„ã«UTCã«å¤‰æ›ã•ã‚Œã‚‹
}
```

## ğŸ”§ æ™‚åˆ»å‡¦ç†ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹å†…ã®ç‰¹åˆ¥ãƒ˜ãƒ«ãƒ‘ãƒ¼
```typescript
// å°æ•°ç‚¹æ™‚é–“â†’Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå¤‰æ›ã‚’å‡¦ç†
private toDate(decimalHour: number): Date {
  // å°æ•°ç‚¹æ™‚é–“ã‚’Dateå½¢å¼ã«å¤‰æ›
  // ä¾‹: 9.5 â†’ 9:30
}
```

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
- ã™ã¹ã¦ã®CRUDæ“ä½œã‚’WebSocketçµŒç”±ã§é…ä¿¡
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯WebSocketã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡æ™‚ã«UIã‚’è‡ªå‹•æ›´æ–°
- Socket.IOãƒ«ãƒ¼ãƒ ã¯ä½¿ç”¨ã›ãšã€å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒå…¨æ›´æ–°ã‚’å—ä¿¡

### æ—¥æœ¬èªãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- ã™ã¹ã¦ã®UIãƒ†ã‚­ã‚¹ãƒˆãŒæ—¥æœ¬èª
- æ—¥æœ¬èªãƒ­ã‚±ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ãŸæ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆå¹´æœˆæ—¥ï¼‰
- React DatePickerã‚’æ—¥æœ¬èªãƒ­ã‚±ãƒ¼ãƒ«ã§è¨­å®š

## ğŸ“Š ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³çµ±ä¸€ä»•æ§˜

### ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã§ã®çµ±ä¸€
- **PostgreSQL**: UTC ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: UTCåŸºæº–ã§ã®æ™‚åˆ»å‡¦ç†ã€JSTå¤‰æ›ã¯å…¥å‡ºåŠ›ã®ã¿
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: JSTåŸºæº–ã§ã®è¡¨ç¤ºã€UTCå¤‰æ›ã¯é€šä¿¡æ™‚ã®ã¿
- **å…¨ã‚·ã‚¹ãƒ†ãƒ **: å†…éƒ¨å‡¦ç†ã¯UTCã€ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤ºã¯JST

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ™‚åˆ»ã‚«ãƒ©ãƒ ä»•æ§˜
```sql
-- æ¨å¥¨: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ä»˜ãã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP

-- æ—¥ä»˜ã®ã¿ã®å ´åˆ
event_date DATE

-- æ™‚åˆ»ã®ã¿ã®å ´åˆï¼ˆã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±ãªã—ã€JSTå‰æï¼‰
start_time TIME
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¦ä»¶

### å¿…é ˆãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
1. **UTCâ†’JSTâ†’UTC ãƒ©ã‚¦ãƒ³ãƒ‰ãƒˆãƒªãƒƒãƒ—ãƒ†ã‚¹ãƒˆ**
2. **å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ**ï¼ˆ23:59ã€00:00ç­‰ï¼‰
3. **å¤æ™‚é–“ãªã—ç¢ºèª**ï¼ˆæ—¥æœ¬ã¯å¤æ™‚é–“ãªã—ï¼‰
4. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜ãƒ»å–å¾—ã®ä¸€è²«æ€§**

### ãƒ†ã‚¹ãƒˆä¾‹
```typescript
describe('Time Conversion', () => {
  it('should maintain consistency in UTCâ†’JSTâ†’UTC conversion', () => {
    const originalUtc = new Date('2025-06-22T00:30:00Z');
    const jstDecimal = utcToJstDecimal(originalUtc); // 9.5
    const backToUtc = jstToUtc(jstDecimal, '2025-06-22');
    expect(backToUtc.getTime()).toBe(originalUtc.getTime());
  });
});
```

---

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: [CLAUDE.md](../../CLAUDE.md)  
**ä½œæˆæ—¥**: 2025-06-26  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: é‹ç”¨ä¸­ï¼ˆå³æ ¼éµå®ˆï¼‰